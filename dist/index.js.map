{"version":3,"file":"index.js","sources":["../src/SRTextParser.ts"],"sourcesContent":["export class SRTextParser {\r\n  private text: string = '';\r\n  private result: any = {};\r\n  private currentData: any;\r\n  private buffer = '';\r\n  private mode: string = 'start'\r\n  private depth = 0;\r\n  private depths: Array<any> = [];\r\n  Parse(what: string) {\r\n    this.result = [];\r\n    this.text = what;\r\n    this.currentData = this.result;\r\n    this.buffer = '';\r\n    this.depths.push(this.currentData);\r\n    for (const char of this.text) {\r\n      \r\n      switch (this.mode) {\r\n        case 'start':\r\n          if (char !== '[') {\r\n            this.buffer += char;\r\n          } else {\r\n            const data: any = {};\r\n            this.currentData[this.buffer] = data;\r\n            this.depths.push(this.currentData[this.buffer]);            \r\n            this.currentData = data;\r\n            this.buffer = '';\r\n            this.mode = 'groupContent';\r\n            this.depth += 1;\r\n            \r\n          }\r\n          break;\r\n        case 'groupContent':\r\n          if (char === '\"') {\r\n            this.mode = 'quotedItem';\r\n          } else if (char === ']') {\r\n            if (this.buffer !== '') {\r\n              if (!(this.currentData['values'])) {\r\n                this.currentData['values'] = [];\r\n              }\r\n              this.currentData.values.push(this.buffer);\r\n            }\r\n            this.buffer = '';\r\n            if (this.depth > 0) {\r\n              this.depths.pop();\r\n              this.depth -= 1;\r\n              this.currentData = this.depths[this.depth];\r\n\r\n\r\n            }\r\n          } else if (char !== '[') {\r\n            if (char === ',') {\r\n              if (this.buffer !== '') {\r\n                if (!(this.currentData['values'])) {\r\n                  this.currentData['values'] = [];\r\n                }\r\n                this.currentData.values.push(this.buffer);\r\n\r\n                this.buffer = '';\r\n              }\r\n              continue;\r\n            }\r\n            this.buffer += char;\r\n          } else {\r\n            const data: any = {}\r\n            if(!!this.currentData[this.buffer]) {\r\n              if(Array.isArray(this.currentData[this.buffer])) {\r\n                this.currentData[this.buffer].push(data);\r\n              } else {\r\n                const currentItem = this.currentData[this.buffer];\r\n                this.currentData[this.buffer] = [currentItem];\r\n                this.currentData[this.buffer].push(data);\r\n              }\r\n\r\n            } else {\r\n              this.currentData[this.buffer] = data;\r\n            }            \r\n            this.depths.push(this.currentData[this.buffer]);\r\n            \r\n            this.currentData = data;\r\n            this.buffer = '';\r\n            this.mode = 'groupContent';\r\n            this.depth += 1;            \r\n          }\r\n          break;\r\n        case 'quotedItem':\r\n          if (char !== '\"') {\r\n            this.buffer += char;\r\n          } else {\r\n            if (this.depth > 0) {\r\n              this.mode = 'groupContent';\r\n              if(!!this.currentData['label']) {\r\n                if(!this.currentData['values']) {\r\n                  this.currentData['values'] = [];\r\n                }\r\n                this.currentData['values'].push(this.buffer);\r\n              } else {\r\n                this.currentData['label'] = this.buffer.replace(/_/g,' ');\r\n              }\r\n            }\r\n            this.buffer = '';\r\n\r\n          }\r\n          break;\r\n      }\r\n    }\r\n    return this.result;\r\n  }  \r\n}\r\n"],"names":[],"mappings":"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"}